<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Übersicht</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <link href="/static/css/custom.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
 <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
 <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
 <![endif]-->

</head>

<body>
 <div class="jumbotron">
        <div class="container">

            <div class="modal fade" id="modal_register">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span> </button>
                            <h4 class="modal-title">Registrieren</h4>

                        </div>
                        <div class="modal-body">
                            <div class="row">

                                <form method="post" id="registerForm">
                                    <div class="form-group">
                                        <label for="emailaddresslabel">E-Mail Adresse</label>

                                        <div class="input-group" data-validate="email">
                                            <input type="text" class="form-control" id="email" name="email" placeholder="E-Mail Adresse eingeben" required>
                                            <span class="input-group-addon danger"><span class="glyphicon glyphicon-remove"></span></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="usernamelabel">Benutzername</label>

                                        <div class="input-group">
                                            <input type="text" class="form-control" id="usernameone" name="username" placeholder="Username eingeben" required>
                                            <span class="input-group-addon danger"><span class="glyphicon glyphicon-remove"></span></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="passwordlabel">Passwort</label>
                                        <input type="password" class="form-control" name="password" id="passwordone" placeholder="Passwort eingeben" autocomplete="off" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="passwordconfirmlabel">Passwort bestätigen</label>


                                        <div class="input-group">
                                            <input type="password" class="form-control" id="passwordconfirm" name="passwordconfirm" placeholder="Passwort bestätigen" autocomplete="off" required>
                                            <span class="input-group-addon danger"><span class="glyphicon glyphicon-remove"></span></span>
                                        </div>

                                    </div>




                                </form>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" id="submit" form="registerForm" class="btn btn-primary">Absenden</button>
                        </div>
                    </div>
                </div>
            </div>
            
            
            
            <div class="modal fade" id="modal_login">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span> </button>
                            <h4 class="modal-title">Login</h4>

                        </div>
                        <div class="modal-body">
                            <div class="row">

                                <form id="login-form" role="form" autocomplete="off">
                                    <div class="form-group">
                                        <label for="logusername">Username</label>
                                        <input type="text" name="logusername" id="logusername" tabindex="1" class="form-control" placeholder="Username" value="" autocomplete="off">
                                    </div>

                                    <div class="form-group">
                                        <label for="logpassword">Passwort</label>
                                        <input type="password" name="logpassword" id="logpassword" tabindex="2" class="form-control" placeholder="Passwort" autocomplete="off">
                                    </div>
                                </form>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" id="login-submit" form="login-form" class="btn btn-primary">Absenden</button>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-md-12">
                   

                        <div class="row">

                            <a href="#modal_register" data-toggle="modal" class="btn btn-primary btn-lg btn-block" id="register_button">Registrieren</a>

                        </div>
                        <br />
                        <div class="row">
                        
                         <a href="#modal_login" data-toggle="modal" class="btn btn-success btn-lg btn-block" id="login_button">Login</a>
                        
                        </div>



                    </div>
                    <!-- jumbotron -->
                </div>
                <!-- col-md-12 -->

            </div>
            <!-- row -->
        </div>
        <!-- container -->
  
        <footer>

        </footer>


        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>
            $(document).ready(function () {

                $('.input-group input[name=username]').on('focusout', function () {

                    var $formVar = $('.input-group input[name=username]');


                    if ($formVar.val().length == 0) {
                        var $form = $formVar.closest('form'),
                            $group = $formVar.closest('.input-group'),
                            $addon = $group.find('.input-group-addon'),
                            $icon = $addon.find('span');

                        $addon.removeClass('success');
                        $addon.addClass('danger');
                        $icon.attr('class', 'glyphicon glyphicon-remove');

                        $('.input-group input[name=username]').removeClass('validated');

                    } else {

                        var data = {
                            username: $("#usernameone").val()
                        }
                        $.ajax({
                            url: "https://localhost:3000/user/search",
                            method: "POST",
                            data: data
                        }).done(function (response) {


                            var $form = $formVar.closest('form'),
                                $group = $formVar.closest('.input-group'),
                                $addon = $group.find('.input-group-addon'),
                                $icon = $addon.find('span');

                            $addon.removeClass('success');
                            $addon.addClass('danger');
                            $icon.attr('class', 'glyphicon glyphicon-remove');
                            $('.input-group input[name=username]').removeClass('validated');



                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            if (jqXHR.status == 404 && $formVar.val().length > 0) {

                                var $form = $formVar.closest('form'),
                                    $group = $formVar.closest('.input-group'),
                                    $addon = $group.find('.input-group-addon'),
                                    $icon = $addon.find('span');

                                $addon.removeClass('danger');
                                $addon.addClass('success');
                                $icon.attr('class', 'glyphicon glyphicon-ok');
                                $('.input-group input[name=username]').addClass('validated');


                            } else if (jqXHR.status == 404 && $formVar.val().length < 1) {

                                var formVar = $('.input-group input[name=username]');
                                var $form = formVar.closest('form'),
                                    $group = formVar.closest('.input-group'),
                                    $addon = $group.find('.input-group-addon'),
                                    $icon = $addon.find('span');

                                $addon.removeClass('success');
                                $addon.addClass('danger');
                                $icon.attr('class', 'glyphicon glyphicon-remove');
                                $('.input-group input[name=username]').removeClass('validated');

                            }
                        });

                    }

                });



                $('.checkloggedin').on('click', function (e) {
                    e.stopPropagation();
                    e.preventDefault();

                    if ($('.dropdown').find('.dropdown-menu').is(":hidden")) {

                        $('.dropdown').find('[data-toggle=dropdown]').dropdown('toggle');

                    }

                });





                $('.input-group input[name=email]').on('keyup change', function () {

                    var $formVar = $('.input-group input[name=email]');
                    var $form = $(this).closest('form'),
                        $group = $(this).closest('.input-group'),
                        $addon = $group.find('.input-group-addon'),
                        $icon = $addon.find('span'),
                        state = false;

                    if (!$group.data('validate')) {
                        state = $(this).val() ? true : false;
                    } else if ($group.data('validate') == "email") {
                        state = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test($(this).val())
                    }

                    if (state) {

                        var data = {
                            email: $("#email").val()
                        }
                        $.ajax({
                            url: "https://localhost:3000/user/search",
                            method: "POST",
                            data: data
                        }).done(function (response) {

                            $addon.removeClass('success');
                            $addon.addClass('danger');
                            $icon.attr('class', 'glyphicon glyphicon-remove');
                            $('.input-group input[name=email]').removeClass('validated');



                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            if (jqXHR.status == 404 && $formVar.val().length > 0) {

                                $addon.removeClass('danger');
                                $addon.addClass('success');
                                $icon.attr('class', 'glyphicon glyphicon-ok');
                                $('.input-group input[name=email]').addClass('validated');


                            } else if (jqXHR.status == 404 && $formVar.val().length < 1) {

                                $addon.removeClass('success');
                                $addon.addClass('danger');
                                $icon.attr('class', 'glyphicon glyphicon-remove');
                                $('.input-group input[name=email]').removeClass('validated');

                            }
                        });

                    } else {
                        $addon.removeClass('success');
                        $addon.addClass('danger');
                        $icon.attr('class', 'glyphicon glyphicon-remove');
                        $('.input-group input[name=email]').removeClass('validated');
                    }

                });


                $(".input-group input[name=passwordconfirm]").keyup(function () {

                    var $form = $(this).closest('form'),
                        $group = $(this).closest('.input-group'),
                        $addon = $group.find('.input-group-addon'),
                        $icon = $addon.find('span');

                    if ($("#passwordone").val() != $("#passwordconfirm").val()) {
                        $addon.removeClass('success');
                        $addon.addClass('danger');
                        $icon.attr('class', 'glyphicon glyphicon-remove');
                        $('.input-group input[name=passwordconfirm]').removeClass('validated');

                    } else {

                        $addon.removeClass('danger');
                        $addon.addClass('success');
                        $icon.attr('class', 'glyphicon glyphicon-ok');
                        $('.input-group input[name=passwordconfirm]').addClass('validated');

                    }
                });



                $("#submit").on("click", function (e) {

                    e.preventDefault();
                    if ($('.input-group input[name=passwordconfirm]').hasClass('validated') && $('.input-group input[name=username]').hasClass('validated') && $('.input-group input[name=email]').hasClass('validated')) {


                        var data = {

                            email: $('#email').val(),
                            password: $('#passwordone').val(),
                            passwordconfirm: $('#passwordconfirm').val(),
                            username: $('#usernameone').val()

                        }

                        $.ajax({
                            type: "POST",
                            url: "https://localhost:3000/user/register",
                            data: data,
                            success: function (response) {
                                window.location = 'https://localhost:3000/add';
                            },
                            error: function () {
                                alert('Es gab einen Fehler bei der Registrierungsanfrage.');
                            }
                        });

                    } else {

                        return false;

                    }

                });


                $("#login-submit").on('click', function (e) {
                        e.preventDefault();

                    if ($("#logusername").val() == "" && $("#logpassword").val() == "") {
                        $("#logusername").attr('style', "border-radius: 5px; border:#FF0000 1px solid;");
                        $("#logpassword").attr('style', "border-radius: 5px; border:#FF0000 1px solid;");
                        return false;
                    } else if ($("#logusername").val() == "" && $("#logpassword").val() != "") {

                        $("#logusername").attr('style', "border-radius: 5px; border:#FF0000 1px solid;");
                        $("#logpassword").removeAttr('style');

                        return false;

                    } else if ($("#logpassword").val() == "" && $("#logusername").val() != "") {
                        $("#logpassword").attr('style', "border-radius: 5px; border:#FF0000 1px solid;");
                        $("#logusername").removeAttr('style');
                        return false;
                    } else {
                        
                          var data = {

                            logusername: $('#logusername').val(),
                            logpassword: $('#logpassword').val()

                        }

                        $.ajax({
                            type: "POST",
                            url: "https://localhost:3000/user/login",
                            data: data,
                            success: function (response) {
                                window.location = 'https://localhost:3000/add';
                            },
                            error: function () {
                                alert('Es gab einen Fehler beim Login.');
                            }
                        });
                        
                        
                    };

                });
            });
        </script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="/static/js/bootstrap.min.js"></script>
</body>

</html>